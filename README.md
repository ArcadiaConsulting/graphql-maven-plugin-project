# GraphQL Maven Plugin

This project is a maven plugin, which makes it possible to work with graphQL in a schema first approach.

It's a work in progress. But the generated code is already ready to use.

## What is this projet

## How to use it

### Server mode

Create a new Maven Project, with this pom, for instance :
<?xml version="1.0"?>
<project xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"
	xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<groupId>com.graphql-java</groupId>
		<artifactId>graphql-maven-plugin-samples</artifactId>
		<version>0.3.0-SNAPSHOT</version>
	</parent>
	<artifactId>graphql-maven-plugin-samples-Forum-server</artifactId>

```xml
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>

	<parent>
		<groupId>org.springframework.boot</groupId>
		<artifactId>spring-boot-starter-parent</artifactId>
		<version>2.1.3.RELEASE</version>
	</parent>

	<groupId>com.graphql-java</groupId>
	<artifactId>mytest-of-graphql-maven-plugin</artifactId>
	<version>0.1.0-SNAPSHOT</version>

	<build>
		<plugins>
			<plugin>
				<groupId>com.graphql-java</groupId>
				<artifactId>graphql-maven-plugin</artifactId>
				<executions>
					<execution>
						<goals>
							<goal>graphql</goal>
						</goals>
					</execution>
				</executions>
				<configuration>
					<packageName>org.my.package</packageName>
					<mode>server</mode>
				</configuration>
			</plugin>
			<plugin>
				<groupId>org.springframework.boot</groupId>
				<artifactId>spring-boot-maven-plugin</artifactId>
				<executions>
					<execution>
						<goals>
							<goal>repackage</goal>
						</goals>
					</execution>
				</executions>
			</plugin>
		</plugins>
	</build>

	<dependencies>
		<!-- Dependencies for tests -->
		<dependency>
			<groupId>org.springframework</groupId>
			<artifactId>spring-test</artifactId>
			<scope>test</scope>
		</dependency>
		<dependency>
			<groupId>org.junit.jupiter</groupId>
			<artifactId>junit-jupiter-api</artifactId>
			<scope>test</scope>
		</dependency>

		<!-- Dependencies for GraphQL -->
		<dependency>
			<groupId>com.graphql-java-kickstart</groupId>
			<artifactId>graphql-spring-boot-starter</artifactId>
		</dependency>
		<dependency>
			<groupId>com.graphql-java-kickstart</groupId>
			<artifactId>graphql-java-tools</artifactId>
		</dependency>
		<dependency>
			<!-- gives a GUI to test the GraphQL request on the generated server: http://localhost:8080/graphiql -->
			<groupId>com.graphql-java-kickstart</groupId>
			<artifactId>graphiql-spring-boot-starter</artifactId>
			<scope>runtime</scope>
		</dependency>

		<!-- Other dependencies -->
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-log4j2</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-data-jpa</artifactId>
		</dependency>
		<dependency>
			<groupId>com.h2database</groupId>
			<artifactId>h2</artifactId>
			<scope>runtime</scope>
		</dependency>
		<dependency>
			<groupId>org.dbunit</groupId>
			<artifactId>dbunit</artifactId>
		</dependency>
	</dependencies>
</project>
```

Then do a first build :
```
mvn clean install
```

The build will complain about the Data Fetchers Delegate you need to define. 

The short story is this one:
* The code generated by the GraphQL maven plugin directly maps to the entity, thanks to [Spring Data JPA](https://spring.io/projects/spring-data-jpa)'s magic.
* The developper still needs to develop the DataFetchers, to manage the relation between objects (see the samples and below, to see how to do this).

A longer story is this one:
* The GraphQL maven plugin expects a database model that is the same as what's in the GraphQL schema. That is: for each GraphQL object, there is a 
table with the same name, and for each field of each of these GraphQL objects, there is a column with the same name and type. This insure the JPA
access to the database. 
* In GraphQL request, a critical factor for performance is the way to query relations between objects. The [graphql-java site](https://www.graphql-java.com/documentation/v12/batching/)
is very clear on this subject. So the maven plugin mark every relational field as transient, and let the developper manage these relations.

So you have to create the Data Fetchers. You can take a look at the projets that are within the graphql-maven-plugin-samples.

Then... you're app is ready to go!
:)


You can access to the GraphQL server with this URL: [http://localhost:8180/graphiql](http://localhost:8180/graphiql). With this interface, you can test your server, by typing any GraphQL query. You'll have some help to type correct values.

You can access to the H2 Console with this URL: [http://localhost:8180/h2-console/](http://localhost:8180/h2-console/). The jdbc URL to connect to the database is: jdbc:h2:mem:testdb. login: sa, no password.


## State of the project

### Things to change

- The plugin currently manages only one schema. It would be nice to allow several graphqls files, with a pattern like /*.graphqls
- The plugin currently manages onyl schema stored in the root of the classpath, that is: in the src/main/resources folder. The doc announces that it can also been stored in a subfolder.

### What the plugin can't manage (as of its current state)

- Fragment in graphql queries
- Scalars
- queries (mutations...) that return data not defined as an object (e.g.: two objects). This needs to be wrapped in some kind of container.
- Comments are not reported in the generated code
- Date, DateTime, Time
- property name which are java key word, like: public, private, class...

### Dependencies needed for the generated code

The generated code depends on:
- log4j2


A typical POM for a project which would use this maven plugin is :

<?xml version="1.0"?>
<project xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"
	xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<modelVersion>4.0.0</modelVersion>
	<artifactId>myArtifact</artifactId>
	<build>
		<plugins>
			<plugin>
				<groupId>com.graphql-java</groupId>
				<artifactId>graphql-maven-plugin</artifactId>
				<version>...</version>
				<executions>
					<execution>
						<goals>
							<goal>graphql</goal>
						</goals>
					</execution>
				</executions>
			</plugin>
		</plugins>
	</build>
	<dependencies>
		<!-- log4j2 is needed for logging -->
		<dependency>
			<groupId>org.apache.logging.log4j</groupId>
			<artifactId>log4j-api</artifactId>
			<version>2.11.2</version>
		</dependency>
		<dependency>
			<groupId>org.apache.logging.log4j</groupId>
			<artifactId>log4j-core</artifactId>
			<version>2.11.2</version>
		</dependency>
	</dependencies>
</project>


### Note for contributors

This projet is a maven plugin project. 

If you want to compile it, you'll have to add the lombok.jar file in your IDE. Please see the relevant section, in the Install menu of the [https://projectlombok.org/][lombok] home page. This very nice tools generates all java boiler plate code, like setters, getters, constructors from fields...



# License

`graphql-maven-plugin` is licensed under the MIT License. See [LICENSE](LICENSE.md) for details.

[lombok]: https://projectlombok.org/